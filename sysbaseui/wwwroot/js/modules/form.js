layui.define(["layer","util"],function(e){"use strict";function t(){this.config={verify:{required:[/[\S]+/,"必填项不能为空"],phone:[/^1\d{10}$/,"请输入正确的手机号"],email:[/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,"邮箱格式不正确"],url:[/^(#|(http(s?)):\/\/|\/\/)[^\s]+\.[^\s]+$/,"链接格式不正确"],number:function(e){if(!e||isNaN(e))return"只能填写数字"},date:[/^(\d{4})[-\/](\d{1}|0\d{1}|1[0-2])([-\/](\d{1}|0\d{1}|[1-2][0-9]|3[0-1]))*$/,"日期格式不正确"],identity:[/(^\d{15}$)|(^\d{17}(x|X|\d)$)/,"请输入正确的身份证号"]},autocomplete:null}}var C=layui.$,h=layui.layer,d=layui.util,l=layui.hint(),w=(layui.device(),"form"),o=".layui-form",T="layui-this",$="layui-hide",E="layui-disabled",i=(t.prototype.set=function(e){return C.extend(!0,this.config,e),this},t.prototype.verify=function(e){return C.extend(!0,this.config.verify,e),this},t.prototype.getFormElem=function(e){return C(o+(e?'[lay-filter="'+e+'"]':""))},t.prototype.on=function(e,t){return layui.onevent.call(this,w,e,t)},t.prototype.val=function(e,i){return this.getFormElem(e).each(function(e,t){var a=C(this);layui.each(i,function(e,t){var i,e=a.find('[name="'+e+'"]');e[0]&&("checkbox"===(i=e[0].type)?e[0].checked=t:"radio"===i?e.each(function(){this.value==t&&(this.checked=!0)}):e.val(t))})}),r.render(null,e),this.getValue(e)},t.prototype.getValue=function(e,t){t=t||this.getFormElem(e);var a={},n={},e=t.find("input,select,textarea");return layui.each(e,function(e,t){var i;C(this);t.name=(t.name||"").replace(/^\s*|\s*&/,""),t.name&&(/^.*\[\]$/.test(t.name)&&(i=t.name.match(/^(.*)\[\]$/g)[0],a[i]=0|a[i],i=t.name.replace(/^(.*)\[\]$/,"$1["+a[i]+++"]")),/^checkbox|radio$/.test(t.type)&&!t.checked||(n[i||t.name]=t.value))}),n},t.prototype.render=function(e,t){var i=this.config,a=C(o+(t?'[lay-filter="'+t+'"]':"")),n={input:function(e){e=e||a.find("input,textarea");i.autocomplete&&e.attr("autocomplete",i.autocomplete)},select:function(e){function p(e,t){C(e.target).parent().hasClass(k)&&!t||(C("."+g).removeClass(g+"ed "+g+"up"),m&&b&&m.val(b)),m=null}function c(a,e,t){var s,r,i,n,o,l,c=C(this),u=a.find("."+k),d=u.find("input"),f=a.find("dl"),h=f.children("dd"),y=f.children("dt"),v=this.selectedIndex;e||(r=c.attr("lay-search"),i=function(){var e=a.offset().top+a.outerHeight()+5-q.scrollTop(),t=f.outerHeight();v=c[0].selectedIndex,a.addClass(g+"ed"),h.removeClass($),y.removeClass($),s=null,h.eq(v).addClass(T).siblings().removeClass(T),e+t>q.height()&&t<=e&&a.addClass(g+"up"),o()},n=function(e){a.removeClass(g+"ed "+g+"up"),d.blur(),s=null,e||l(d.val(),function(e){var t=c[0].selectedIndex;e&&(b=C(c[0].options[t]).html(),0===t&&b===d.attr("placeholder")&&(b=""),d.val(b||""))})},o=function(){var e,t,i=f.children("dd."+T);i[0]&&(e=i.position().top,t=f.height(),i=i.height(),t<e&&f.scrollTop(e+f.scrollTop()-t+i-5),e<0&&f.scrollTop(e+f.scrollTop()-5))},u.on("click",function(e){a.hasClass(g+"ed")?n():(p(e,!0),i()),f.find("."+x).remove()}),u.find(".layui-edge").on("click",function(){d.focus()}),d.on("keyup",function(e){9===e.keyCode&&i()}).on("keydown",function(l){var e=l.keyCode,r=(9===e&&n(),function(a,n){l.preventDefault();var e=function(){var e=f.children("dd."+T);if(f.children("dd."+$)[0]&&"next"===a){var t=f.children("dd:not(."+$+",."+E+")"),i=t.eq(0).index();if(0<=i&&i<e.index()&&!t.hasClass(T))return t.eq(0).prev()[0]?t.eq(0).prev():f.children(":last")}return n&&n[0]?n:s&&s[0]?s:e}(),t=e[a](),i=e[a]("dd:not(."+$+")");return t[0]?(s=e[a](),i[0]&&!i.hasClass(E)||!s[0]?(i.addClass(T).siblings().removeClass(T),void o()):r(a,s)):s=null});38===e&&r("prev"),40===e&&r("next"),13===e&&(l.preventDefault(),f.children("dd."+T).trigger("click"))}),l=function(a,e,n){var l=0,t=(layui.each(h,function(){var e=C(this),t=e.text(),i=("cs"!==r&&(t=t.toLowerCase(),a=a.toLowerCase()),-1===t.indexOf(a));(""===a||"blur"===n?a!==t:i)&&l++,"keyup"===n&&e[i?"addClass":"removeClass"]($)}),"keyup"===n&&layui.each(y,function(){var e=C(this),t=e.nextUntil("dt").filter("dd");e[t.length==t.filter("."+$).length?"addClass":"removeClass"]($)}),l===h.length);return e(t),t},t&&d.on("keyup",function(e){var t=this.value,e=e.keyCode;if(9===e||13===e||37===e||38===e||39===e||40===e)return!1;l(t,function(e){e?f.find("."+x)[0]||f.append('<p class="'+x+'">无匹配项</p>'):f.find("."+x).remove()},"keyup"),""===t&&f.find("."+x).remove(),o()}).on("blur",function(e){var t=c[0].selectedIndex;m=d,b=C(c[0].options[t]).html(),0===t&&b===d.attr("placeholder")&&(b=""),setTimeout(function(){l(d.val(),function(e){b||d.val("")},"blur")},200)}),h.on("click",function(){var e=C(this),t=e.attr("lay-value"),i=c.attr("lay-filter");return e.hasClass(E)||(e.hasClass("layui-select-tips")?d.val(""):(d.val(e.text()),e.addClass(T)),e.siblings().removeClass(T),c.val(t).removeClass("layui-form-danger"),layui.event.call(this,w,"select("+i+")",{elem:c[0],value:t,othis:a}),n(!0)),!1}),a.find("dl>dt").on("click",function(e){return!1}),C(document).off("click",p).on("click",p))}var m,u="请选择",g="layui-form-select",k="layui-select-title",x="layui-select-none",b="",e=e||a.find("select");e.each(function(e,t){var i=C(this),a=i.next("."+g),n=this.disabled,l=t.value,r=C(t.options[t.selectedIndex]),t=t.options[0];if("string"==typeof i.attr("lay-ignore"))return i.show();var s,o="string"==typeof i.attr("lay-search"),t=t&&!t.value&&t.innerHTML||u,r=C(['<div class="'+(o?"":"layui-unselect ")+g,(n?" layui-select-disabled":"")+'">','<div class="'+k+'">','<input type="text" placeholder="'+d.escape(C.trim(t))+'" value="'+d.escape(C.trim(l?r.html():""))+'"'+(!n&&o?"":" readonly")+' class="layui-input'+(o?"":" layui-unselect")+(n?" "+E:"")+'">','<i class="layui-edge"></i></div>','<dl class="layui-anim layui-anim-upbit'+(i.find("optgroup")[0]?" layui-select-group":"")+'">',(t=i.find("*"),s=[],layui.each(t,function(e,t){0!==e||t.value?"optgroup"===t.tagName.toLowerCase()?s.push("<dt>"+t.label+"</dt>"):s.push('<dd lay-value="'+d.escape(t.value)+'" class="'+(l===t.value?T:"")+(t.disabled?" "+E:"")+'">'+C.trim(t.innerHTML)+"</dd>"):s.push('<dd lay-value="" class="layui-select-tips">'+C.trim(t.innerHTML||u)+"</dd>")}),0===s.length&&s.push('<dd lay-value="" class="'+E+'">没有选项</dd>'),s.join("")+"</dl>"),"</div>"].join(""));a[0]&&a.remove(),i.after(r),c.call(this,r,n,o)})},checkbox:function(e){var o={checkbox:["layui-form-checkbox","layui-form-checked","checkbox"],_switch:["layui-form-switch","layui-form-onswitch","switch"]},e=e||a.find("input[type=checkbox]");e.each(function(e,t){var i=C(this),a=i.attr("lay-skin"),n=(i.attr("lay-text")||"").split("|"),l=this.disabled,r=o[a="switch"===a?"_"+a:a]||o.checkbox;if("string"==typeof i.attr("lay-ignore"))return i.show();var s=i.next("."+r[0]),t=C(['<div class="layui-unselect '+r[0],t.checked?" "+r[1]:"",l?" layui-checkbox-disabled "+E:"",'"',a?' lay-skin="'+a+'"':"",">",(l={checkbox:[t.title.replace(/\s/g,"")?"<span>"+t.title+"</span>":"",'<i class="layui-icon layui-icon-ok"></i>'].join(""),_switch:"<em>"+((t.checked?n[0]:n[1])||"")+"</em><i></i>"})[a]||l.checkbox,"</div>"].join(""));s[0]&&s.remove(),i.after(t),function(i,a){var n=C(this);i.on("click",function(){var e=n.attr("lay-filter"),t=(n.attr("lay-text")||"").split("|");n[0].disabled||(n[0].checked?(n[0].checked=!1,i.removeClass(a[1]).find("em").text(t[1])):(n[0].checked=!0,i.addClass(a[1]).find("em").text(t[0])),layui.event.call(n[0],w,a[2]+"("+e+")",{elem:n[0],value:n[0].value,othis:i}))})}.call(this,t,r)})},radio:function(e){var r="layui-form-radio",s=["&#xe643;","&#xe63f;"],e=e||a.find("input[type=radio]");e.each(function(e,t){var i=C(this),a=i.next("."+r),n=this.disabled;if("string"==typeof i.attr("lay-ignore"))return i.show();a[0]&&a.remove();n=C(['<div class="layui-unselect '+r,t.checked?" "+r+"ed":"",(n?" layui-radio-disabled "+E:"")+'">','<i class="layui-anim layui-icon">'+s[t.checked?0:1]+"</i>","<div>"+(a=t.title||"",a="string"==typeof i.next().attr("lay-radio")?i.next().html():a)+"</div>","</div>"].join(""));i.after(n),function(a){var n=C(this),l="layui-anim-scaleSpring";a.on("click",function(){var e=n[0].name,t=n.parents(o),i=n.attr("lay-filter"),t=t.find("input[name="+e.replace(/(\.|#|\[|\])/g,"\\$1")+"]");n[0].disabled||(layui.each(t,function(){var e=C(this).next("."+r);this.checked=!1,e.removeClass(r+"ed"),e.find(".layui-icon").removeClass(l).html(s[1])}),n[0].checked=!0,a.addClass(r+"ed"),a.find(".layui-icon").addClass(l).html(s[0]),layui.event.call(n[0],w,"radio("+i+")",{elem:n[0],value:n[0].value,othis:a}))})}.call(this,n)})}};return"object"===layui.type(e)?e.each(function(e,t){var i=C(t);i.closest(o).length&&("SELECT"===t.tagName?n.select(i):"INPUT"===t.tagName&&("checkbox"===(t=t.type)||"radio"===t?n[t](i):n.input(i)))}):e?n[e]?n[e]():l.error('不支持的 "'+e+'" 表单渲染'):layui.each(n,function(e,t){t()}),this},t.prototype.validate=function(e){var u=null,d=r.config.verify,f="layui-form-danger";return!(e=C(e))[0]||(void 0!==e.attr("lay-verify")||!1!==this.validate(e.find("*[lay-verify]")))&&(layui.each(e,function(e,r){var s=C(this),t=(s.attr("lay-verify")||"").split("|"),o=s.attr("lay-verType"),c=s.val();if(s.removeClass(f),layui.each(t,function(e,t){var i="",a=d[t];if(a){var n="function"==typeof a?i=a(c,r):!a[0].test(c),l="select"===r.tagName.toLowerCase()||/^checkbox|radio$/.test(r.type),i=i||a[1];if("required"===t&&(i=s.attr("lay-reqText")||i),n)return"tips"===o?h.tips(i,"string"!=typeof s.attr("lay-ignore")&&l?s.next():s,{tips:1}):"alert"===o?h.alert(i,{title:"提示",shadeClose:!0}):/\bstring|number\b/.test(typeof i)&&h.msg(i,{icon:5,shift:6}),setTimeout(function(){(l?s.next().find("input"):r).focus()},7),s.addClass(f),u=!0}}),u)return u}),!u)},t.prototype.submit=function(e,t){var i=C(this),e="string"==typeof e?e:i.attr("lay-filter"),a=this.getFormElem?this.getFormElem(e):i.parents(o).eq(0),n=a.find("*[lay-verify]");if(!r.validate(n))return!1;n=r.getValue(null,a),a={elem:this.getFormElem?window.event&&window.event.target:this,form:(this.getFormElem?a:i.parents("form"))[0],field:n};return"function"==typeof t&&t(a),layui.event.call(this,w,"submit("+e+")",a)}),r=new t,a=C(document),q=C(window);C(function(){r.render()}),a.on("reset",o,function(){var e=C(this).attr("lay-filter");setTimeout(function(){r.render(null,e)},50)}),a.on("submit",o,i).on("click","*[lay-submit]",i),e(w,r)});